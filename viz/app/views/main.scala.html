@*
 * This template is called from the `index` template. This template
 * handles the rendering of the page header and body tags. It takes
 * two arguments, a `String` for the title of the page and an `Html`
 * object to insert into the body of the page.
 *@
@(title: String)(formContent: FormContent)

<!DOCTYPE html>
<html lang="en">
    <head>
        @* Here's where we render the page title `String`. *@
        <title>@title</title>
        <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/main.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/brat-style-vis.css")">
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.versioned("images/favicon.png")">
        <link rel="stylesheet" media="screen" href="@routes.WebJarAssets.at(WebJarAssets.locate("bootstrap.min.css"))">
        <script src="@routes.WebJarAssets.at(WebJarAssets.locate("jquery.min.js"))"></script>
        <script src="@routes.WebJarAssets.at(WebJarAssets.locate("head.js"))"></script>
        <script src="@routes.WebJarAssets.at(WebJarAssets.locate("bootstrap.min.js"))"></script>
        <script src="@routes.Assets.versioned("javascripts/TextILPMain.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/util.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/visualizer.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/dispatcher.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/url_monitor.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/webfont.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/annotation_log.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/configuration.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/jquery.svg.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/jquery.svgdom.min.js")" type="text/javascript"></script>
        <script>
            // event for setting one of the pre-filled questions
            //var content = "@formContent";
            //console.log(content);
            $(document).ready(function() {
                $("#ready-questions").change(function () {
                    console.log("change");
                    var selectedIndex = $(this).prop("selectedIndex") - 1;
                    console.log("yo yo yo ");
                    window.location = '/getPrefilledQuestion?index=' + selectedIndex;
                    /*
                    $.ajax({
                        type: 'GET',
                        url: "/getPrefilledQuestion2",
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        data: { "index": selectedIndex },
                        success: function(response) {
                            console.log("sent .... ");
                        },
                        error: function(xhr) {
                            console.log("failed .... ");
                        }
                    });
                    console.log(selectedIndex);
                    $("#questionString").attr("value", "@{formContent.preFilledQuestions.questions(0).str}");
                    */
                });

                console.log("Embeding brat libraies ");
                head.js(
                    // External libraries
                    'http://localhost:9000/assets/javascripts/jquery.svg.min.js',
                    'http://localhost:9000/assets/javascripts/jquery.svgdom.min.js',
                    // brat helper modules
                    'http://localhost:9000/assets/javascripts/configuration.js',
                    'http://localhost:9000/assets/javascripts/util.js',
                    'http://localhost:9000/assets/javascripts/annotation_log.js',
                    'http://localhost:9000/assets/javascripts/webfont.js',
                    // brat modules
                    'http://localhost:9000/assets/javascripts/dispatcher.js',
                    'http://localhost:9000/assets/javascripts/url_monitor.js',
                    'http://localhost:9000/assets/javascripts/visualizer.js'
                );

                var docData = {
                    // Our text of choice
                    text     : "Ed O'Kelley was the man who shot the man who shot Jesse James.",
                    // The entities entry holds all entity annotations
                    entities : [
                        /* Format: [${ID}, ${TYPE}, [[${START}, ${END}]]]
                         note that range of the offsets are [${START},${END}) */
                        ['T1', 'Person', [[0, 11]]],
                        ['T2', 'Person', [[20, 23]]],
                        ['T3', 'Person', [[37, 40]]],
                        ['T4', 'Person', [[50, 61]]]
                    ]
                };

                var text = "Ed O'Kelley was the man who shot the man who shot Jesse James.";
                var entities = [
                    [
                        "T1",
                        "Person",
                        [ [ 0, 11 ] ]
                    ],
                    [
                        "T2",
                        "Person",
                        [ [ 20, 23 ] ]
                    ],
                    [
                        "T3",
                        "Person",
                        [ [ 37, 40 ] ]
                    ],
                    [
                        "T4",
                        "Person",
                        [ [ 50, 61 ] ]
                    ]
                ];

                var relations = [
                    [
                        "R1",
                        "Anaphora",
                        [ [ "Anaphor", "T2" ], [ "Entity", "T1" ] ]
                    ]
                ];

                console.log("Applying the embed method ");
                // brat-visualization
                Util.embed("brat-visualization",
                        {entity_types: [], relation_types: []},
                        {text: text, entities: entities, relations: relations}
                );
                console.log("done embedding");
            });
        </script>
    </head>
    <body>
        <div style="padding:50px;">
            <div class="page-header">
                <h1><a href="/">TextILP</a> <small>  Structured Question Answering on top of raw text</small></h1>
            </div>
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                        <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="#">TextILP</a>
                    </div>
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li class="active"><a href="#">Link <span class="sr-only">(current)</span></a></li>
                            <li><a href="#">Link</a></li>
                            <li class="dropdown">
                                <a href="#" id="solver-dropdown" class="dropdown-toggle" data-toggle="dropdown"
                                    role="button" aria-haspopup="true" aria-expanded="false">Solver: @formContent.solverType <span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li id="selectTableILP"><a href="#">TextILP</a></li>
                                    <li role="separator" class="divider"></li>
                                    <li id="selectSalience"><a href="#">Salience</a></li>
                                    <li id="selectLucene"><a href="#">Lucene</a></li>
                                </ul>
                            </li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="#">About</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
            <div class="alert alert-success" role="alert">
                <h4>Type a new question below, or select one of the existing ones</h4>
                <select class="form-control" id="ready-questions" >
                    <option disabled selected value> -- select one -- </option>
                    @for((question, idx) <- formContent.preFilledQuestions.questions.zipWithIndex) {
                        <option value="@{idx+1}">@question.str</option>
                    }
                </select>
                <br>
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Raw question" id="questionString"
                        @if(formContent.questionOpt.isDefined) {value="@formContent.questionOpt.get.str"}>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Candidate Option</h3>
                    </div>
                    <div class="panel-body">
                        <h5> Where to get candidate answers?  </h5>
                        <form>
                            <input type="radio" id="candidateAuto" name="candidates"
                            @if(formContent.candidateGeneration==CandidatesAutomatic) {checked}> Automatically extract candidate answers <br>
                            <input type="radio" id="candidatesManual" name="candidates"
                            @if(formContent.candidateGeneration==CandidatesGiven) {checked}> You manually enter the candidates<br>
                        </form>
                        <textarea rows="2" id="candidateTextArea" style="width: 100%;">@if(formContent.questionOpt.isDefined) {@formContent.questionOpt.get.questionChoice} else { Separate the candidates with "//" }</textarea>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">External Knowledge</h3>
                    </div>
                    <div class="panel-body">
                        <h5> How to get the necessary knowledge? </h5>
                        <form>
                            <input type="radio" name="excerpt-extraction" id="knowLucene"
                            @if(formContent.externalKnowledge==LuceneKnowledge) {checked}> Automatic excerp extraction with Lucene<br>
                            <input type="radio" name="excerpt-extraction" id="knowManual"
                            @if(formContent.externalKnowledge==KnowledgeGiven) {checked}> You manually enter a text<br>
                        </form>
                        <textarea rows="6" id="knowTextArea" @if(formContent.externalKnowledge!=KnowledgeGiven) { disabled=true } style="width: 100%;">@if(formContent.questionOpt.isDefined) {@formContent.questionOpt.get.snippet.str} else {}</textarea>
                    </div>
                </div>
                <fieldset>
                    <div class="form-group">
                        <form class="col-sm-offset-2 col-sm-10">
                            <button id="submitBtn" type="submit" value="Submit" class="btn btn-primary">Submit</button>
                            <button id="cancelBtn" class="btn">Cancel</button>
                        </form>
                    </div>
                </fieldset>
            </div>
            <div class="well" >
                    <svg width="100" height="100" id="brat-visualization">
                    </svg>
            </div>
            <div class="panel-group">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" href="#collapse1">Solver Log</a>
                        </h4>
                    </div>
                    <div id="collapse1" class="panel-collapse collapse">
                        <div class="panel-body">@formContent.solverLog</div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
